pipeline {
   agent any
   tools {
       maven 'Maven'
   }
   environment {
       DOCKER_IMAGE = 'roufaida1/calculator:latest'
       DOCKER_CREDENTIALS = credentials('docker-hub-credentials') 
   }
   stages {
       stage('Build') {
           steps {
               bat 'mvn clean package'
           }
       }
       
       stage('Test') {
           steps {
               bat 'mvn test'
           }
       }

       stage('Docker Build') {
           steps {
               script {
                   bat 'docker build -t %DOCKER_IMAGE% .'
               }
           }
       }

       stage('Docker Push') {
           steps {
               script {
                   withCredentials([usernamePassword(credentialsId: 'docker-hub-credentials', passwordVariable: 'DOCKER_PASSWORD', usernameVariable: 'DOCKER_USERNAME')]) {
                       bat 'docker login -u %DOCKER_USERNAME% -p %DOCKER_PASSWORD%'
                       bat 'docker push %DOCKER_IMAGE%'
                   }
               }
           }
       }
   }
   post {
       always {
           bat 'docker logout'
       }
       success {
           echo 'Pipeline succeeded'
       }
       failure {
           echo 'Pipeline failed'
       }
   }
}
